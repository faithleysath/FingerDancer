<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finger Dance</title>
    <!-- 引入 Inter 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- 1. Tone.js 脚本移到了 body 末尾 -->

    <style>
        /* 1. 基本设置 */
        :root {
            --bg-color: #10b981; /* 灵感来自视频的绿色 */
            --dot-color: #ffffff;
            --dot-pressed: #000000;
            --dot-inactive-opacity: 0.3;
            --text-color: #ffffff;
            --panel-bg: rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            /* 防止在快速按键时选中文本 */
            user-select: none;
        }

        /* 2. 屏幕切换 */
        .screen {
            display: none;
            width: 90%;
            max-width: 600px; /* 增加了最大宽度以容纳5个键 */
            padding: 20px;
            border-radius: 16px;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .screen.active {
            display: block;
        }

        h1, h2 {
            text-align: center;
            font-weight: 900;
            margin-bottom: 24px;
        }

        /* 3. 关卡选择 */
        #level-select-screen .level-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            /* 新增：添加滚动条 */
            max-height: 60vh;
            overflow-y: auto;
            /* 新增：为滚动条留出一点空间，防止按钮紧贴边缘 */
            padding-right: 5px;
        }

        .level-btn, .action-btn {
            background-color: var(--dot-color);
            color: var(--bg-color);
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s ease, background-color 0.2s;
        }

        .level-btn:hover, .action-btn:hover {
            transform: scale(1.03);
            background-color: #f0fdf4;
        }

        /* 4. 游戏屏幕 */
        #game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        #level-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        #timer {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 80px;
            text-align: right;
        }

        #step-counter {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .pattern-container {
            display: flex;
            justify-content: center;
            align-items: center; /* 确保不同高度的元素垂直居中 */
            gap: 15px;
            margin-bottom: 10px;
        }
        
        /* 游戏中的圆点 */
        .dot {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--dot-color);
            background-color: transparent;
            opacity: var(--dot-inactive-opacity);
            transition: all 0.05s ease;
        }

        /* --- 新增：空格键的点 --- */
        #target-space, #player-space {
            width: 120px; /* 更宽，像空格键 */
            border-radius: 10px; /* 圆角矩形 */
        }

        /* 目标图案的 "按下" 状态 */
        #target-pattern-display .dot.pressed {
            background-color: var(--dot-pressed);
            opacity: 1;
        }

        /* 玩家的 "按下" 状态 */
        #player-pattern-display .dot.player-pressed {
            background-color: var(--dot-color);
            opacity: 1;
            transform: scale(1.05);
        }
        
        /* 按键提示 */
        #key-labels {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .key-label {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.5);
        }

        /* --- 新增：空格键的标签 --- */
        #label-space {
            width: 120px;
            font-size: 1.5rem; /* 字体小一点以适应 "SPACE" */
        }


        /* 5. 结果屏幕 */
        #result-screen {
            text-align: center;
        }

        #rank {
            font-size: 6rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 10px;
            color: #fde047; /* S级用金色 */
        }
        
        #rank.rank-A { color: #c0c0c0; } /* 银色 */
        #rank.rank-B { color: #cd7f32; } /* 铜色 */
        #rank.rank-C { color: #a3a3a3; }

        #final-time {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 30px;
        }

        /* 新增：为结果按钮添加间距 */
        #result-screen .action-btn {
            margin: 5px 10px; /* 垂直和水平间距 */
        }

    </style>
</head>
<body>

    <!-- 主容器 -->
    <main id="game-container">

        <!-- 1. 关卡选择屏幕 -->
        <section id="level-select-screen" class="screen active">
            <h1>Finger Dance</h1>
            <div id="level-list" class="level-list">
                <!-- 关卡按钮将由 JS 动态生成 -->
            </div>
        </section>

        <!-- 2. 游戏屏幕 -->
        <section id="game-screen" class="screen">
            <div id="game-header">
                <span id="level-title">Level 1</span>
                <span id="timer">0.00s</span>
            </div>

            <!-- 目标图案 -->
            <div id="target-pattern-display" class="pattern-container">
                <!-- 新增：空格键 -->
                <div class="dot" id="target-space"></div> 
                <div class="dot" id="target-j"></div>
                <div class="dot" id="target-k"></div>
                <div class="dot" id="target-l"></div>
                <div class="dot" id="target-semi"></div>
            </div>

            <!-- 玩家输入图案 -->
            <div id="player-pattern-display" class="pattern-container">
                <!-- 新增：空格键 -->
                <div class="dot" id="player-space"></div>
                <div class="dot" id="player-j"></div>
                <div class="dot" id="player-k"></div>
                <div class="dot" id="player-l"></div>
                <div class="dot" id="player-semi"></div>
            </div>

            <!-- 按键提示 -->
            <div id="key-labels" class="pattern-container">
                <!-- 新增：空格键 -->
                <div class="key-label" id="label-space">SPACE</div>
                <div class="key-label">J</div>
                <div class="key-label">K</div>
                <div class="key-label">L</div>
                <div class="key-label">;</div>
            </div>
            
            <div id="step-counter">Step 1 / 5</div>
        </section>

        <!-- 3. 结果屏幕 -->
        <section id="result-screen" class="screen">
            <h2>Level Complete!</h2>
            <div id="rank">S</div>
            <div id="final-time">Your Time: 3.45s</div>
            <!-- 修改：添加 "下一关" 按钮，并调整了按钮顺序 -->
            <button id="next-level-btn" class="action-btn">下一关 (任意键)</button>
            <button id="back-to-menu-btn" class="action-btn">Back to Menu</button>
        </section>

    </main>

    <!-- 1. 引入 Tone.js (移到 body 末尾，确保在主脚本前加载) -->
    <!-- 尝试使用 jsdelivr CDN，因为 cdnjs 似乎加载失败 -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>

    <script>
        window.onload = () => {

            // 添加一个检查，确保 Tone.js 已经加载
            let audioEnabled = true;
            if (typeof Tone === 'undefined') {
                console.error("Tone.js library failed to load. Audio will be disabled.");
                audioEnabled = false;
            }

            // 将所有游戏逻辑封装到一个函数中
            initGame(audioEnabled);
        };

        // 将所有游戏逻辑封装到一个函数中，以便我们可以有条件地初始化它
        function initGame(audioEnabled) {
            
            // --- 0. 音频设置 ---
            let polySynth, reverb;
            if (audioEnabled) {
                reverb = new Tone.Reverb(0.7).toDestination();
                polySynth = new Tone.PolySynth(Tone.Synth).connect(reverb);
            }
            
            // 为每个按键分配一个音符
            const KEY_NOTES = {
                ' ': 'C3',
                'j': 'G3',
                'k': 'A3',
                'l': 'C4',
                ';': 'E4'
            };

            // --- 1. 关卡数据定义 ---
            // 修改：新增空格键 ' '
            const KEYS = [' ', 'j', 'k', 'l', ';'];
            
            // 修改：新增空格键映射，并更新索引
            const KEY_MAP = { ' ': 0, 'j': 1, 'k': 2, 'l': 3, ';': 4 };
            
            // 修改：关卡数据，所有图案数组变为5个元素
            // [Space, J, K, L, ;]
            const LEVELS = [
                // --- 12 关卡 (加长版) ---
                {
                    name: "1. Introduction (All Keys)",
                    patterns: [ 
                        [0,1,0,0,0], [0,0,0,0,0], [0,1,0,0,0], [0,0,0,0,0], // J x2
                        [0,0,1,0,0], [0,0,0,0,0], [0,0,1,0,0], [0,0,0,0,0], // K x2
                        [0,0,0,1,0], [0,0,0,0,0], [0,0,0,1,0], [0,0,0,0,0], // L x2
                        [0,0,0,0,1], [0,0,0,0,0], [0,0,0,0,1], [0,0,0,0,0], // ; x2
                        [1,0,0,0,0], [0,0,0,0,0], [1,0,0,0,0], [0,0,0,0,0]  // Space x2
                    ],
                    ranks: [10, 15, 20] // 调整了时间
                },
                {
                    name: "2. Simple Pairs (J+K, L+;)",
                    patterns: [ 
                        [0,1,1,0,0], [0,0,0,0,0], [0,0,0,1,1], [0,0,0,0,0],
                        [0,1,1,0,0], [0,0,0,0,0], [0,0,0,1,1], [0,0,0,0,0],
                        [0,1,1,0,0], [0,0,0,0,0], [0,0,0,1,1], [0,0,0,0,0]
                    ],
                    ranks: [8, 12, 16] // x3
                },
                {
                    name: "3. Thumb Combos (Space+)",
                    patterns: [ 
                        [1,1,0,0,0], [0,0,0,0,0], [1,0,1,0,0], [0,0,0,0,0],
                        [1,1,0,0,0], [0,0,0,0,0], [1,0,1,0,0], [0,0,0,0,0],
                        [1,1,0,0,0], [0,0,0,0,0], [1,0,1,0,0], [0,0,0,0,0]
                    ],
                    ranks: [8, 12, 16] // x3
                },
                {
                    name: "4. Basic Alternation (J, K, J, K)",
                    patterns: [ 
                        [0,1,0,0,0], [0,0,1,0,0], [0,1,0,0,0], [0,0,1,0,0], [0,0,0,0,0],
                        [0,1,0,0,0], [0,0,1,0,0], [0,1,0,0,0], [0,0,1,0,0], [0,0,0,0,0],
                        [0,1,0,0,0], [0,0,1,0,0], [0,1,0,0,0], [0,0,1,0,0], [0,0,0,0,0]
                    ],
                    ranks: [10, 15, 20] // x3
                },
                {
                    name: "5. Skipping Keys (J+L, K+;)",
                    patterns: [ 
                        [0,1,0,1,0], [0,0,0,0,0], [0,0,1,0,1], [0,0,0,0,0],
                        [0,1,0,1,0], [0,0,0,0,0], [0,0,1,0,1], [0,0,0,0,0],
                        [0,1,0,1,0], [0,0,0,0,0], [0,0,1,0,1], [0,0,0,0,0]
                    ],
                    ranks: [9, 13, 18] // x3
                },
                {
                    name: "6. Outer Edges (Space+;, J+;)",
                    patterns: [ 
                        [1,0,0,0,1], [0,0,0,0,0], [0,1,0,0,1], [0,0,0,0,0],
                        [1,0,0,0,1], [0,0,0,0,0], [0,1,0,0,1], [0,0,0,0,0],
                        [1,0,0,0,1], [0,0,0,0,0], [0,1,0,0,1], [0,0,0,0,0]
                    ],
                    ranks: [9, 13, 18] // x3
                },
                {
                    name: "7. First Trios (J+K+L, K+L+;)",
                    patterns: [ 
                        [0,1,1,1,0], [0,0,0,0,0], [0,0,1,1,1], [0,0,0,0,0],
                        [0,1,1,1,0], [0,0,0,0,0], [0,0,1,1,1], [0,0,0,0,0],
                        [0,1,1,1,0], [0,0,0,0,0], [0,0,1,1,1], [0,0,0,0,0]
                    ],
                    ranks: [10, 15, 22] // x3
                },
                {
                    name: "8. Simple Rolls (J -> J+K -> J+K+L)",
                    patterns: [ 
                        [0,1,0,0,0], [0,1,1,0,0], [0,1,1,1,0], [0,0,0,0,0],
                        [0,1,0,0,0], [0,1,1,0,0], [0,1,1,1,0], [0,0,0,0,0]
                    ],
                    ranks: [9, 15, 20] // x2
                },
                {
                    name: "9. Thumb Rolls (Space -> Space+J -> Space+J+K)",
                    patterns: [ 
                        [1,0,0,0,0], [1,1,0,0,0], [1,1,1,0,0], [0,0,0,0,0],
                        [1,0,0,0,0], [1,1,0,0,0], [1,1,1,0,0], [0,0,0,0,0]
                    ],
                    ranks: [9, 15, 20] // x2
                },
                {
                    name: "10. Full Hand Chords (3-key & 4-key)",
                    patterns: [ 
                        [1,1,0,1,0], [0,0,0,0,0], [1,0,1,0,1], [0,0,0,0,0], 
                        [0,1,1,0,1], [0,0,0,0,0], [1,1,1,1,0], [0,0,0,0,0],
                        [1,1,0,1,0], [0,0,0,0,0], [1,0,1,0,1], [0,0,0,0,0], 
                        [0,1,1,0,1], [0,0,0,0,0], [1,1,1,1,0], [0,0,0,0,0]
                    ],
                    ranks: [14, 22, 30] // x2
                },
                {
                    name: "11. The Five Keys (All Keys!)",
                    patterns: [ 
                        [1,1,1,1,1], [0,0,0,0,0], [1,1,1,1,1], [0,0,0,0,0],
                        [1,1,1,1,1], [0,0,0,0,0], [1,1,1,1,1], [0,0,0,0,0]
                    ],
                    ranks: [7, 10, 14] // x2 (This one should be fast)
                },
                {
                    name: "12. Finale (A mix of everything)",
                    patterns: [ 
                        [1,1,0,0,1], [0,0,0,0,0], [0,1,0,1,0], [0,0,0,0,0], 
                        [1,0,1,0,1], [0,0,0,0,0], [0,0,1,1,1], [0,0,0,0,0], [1,1,1,1,1], [0,0,0,0,0],
                        [1,1,0,0,1], [0,0,0,0,0], [0,1,0,1,0], [0,0,0,0,0], 
                        [1,0,1,0,1], [0,0,0,0,0], [0,0,1,1,1], [0,0,0,0,0], [1,1,1,1,1], [0,0,0,0,0]
                    ],
                    ranks: [16, 25, 35] // x2
                }
                // --- 关卡结束 ---
            ];

            // --- 2. 状态变量 ---
            let playerState = [0, 0, 0, 0, 0]; // 修改：5个元素
            let currentLevelIndex = -1; // 修改：用于追踪当前关卡索引
            let currentLevel = null; // 新增：将 currentLevel 移到这里
            let currentStep = 0;
            let startTime = 0;
            let timerInterval = null;
            let gameActive = false;

            // --- 3. DOM 元素引用 ---
            const screens = {
                levelSelect: document.getElementById('level-select-screen'),
                game: document.getElementById('game-screen'),
                result: document.getElementById('result-screen'),
            };

            const dom = {
                levelList: document.getElementById('level-list'),
                levelTitle: document.getElementById('level-title'),
                timer: document.getElementById('timer'),
                stepCounter: document.getElementById('step-counter'),
                // 修改：新增 'target-space'
                targetDots: [
                    document.getElementById('target-space'),
                    document.getElementById('target-j'),
                    document.getElementById('target-k'),
                    document.getElementById('target-l'),
                    document.getElementById('target-semi')
                ],
                // 修改：新增 'player-space'
                playerDots: [
                    document.getElementById('player-space'),
                    document.getElementById('player-j'),
                    document.getElementById('player-k'),
                    document.getElementById('player-l'),
                    document.getElementById('player-semi')
                ],
                rank: document.getElementById('rank'),
                finalTime: document.getElementById('final-time'),
                backToMenuBtn: document.getElementById('back-to-menu-btn'),
                nextLevelBtn: document.getElementById('next-level-btn'), // 新增
            };

            // --- 4. 核心功能函数 ---

            /**
             * 切换显示的屏幕
             * @param {string} screenId ('levelSelect', 'game', 'result')
             */
            function showScreen(screenId) {
                Object.values(screens).forEach(screen => screen.classList.remove('active'));
                screens[screenId].classList.add('active');
            }

            /**
             * 初始化关卡选择列表
             */
            function setupLevelSelect() {
                dom.levelList.innerHTML = ''; // 清空列表
                LEVELS.forEach((level, index) => {
                    const button = document.createElement('button');
                    button.textContent = level.name;
                    button.className = 'level-btn';
                    button.onclick = () => {
                        // 2. 在用户点击时启动 Tone.js
                        if (audioEnabled && Tone.context.state !== 'running') {
                            Tone.start();
                        }
                        startGame(index);
                    };
                    dom.levelList.appendChild(button);
                });
            }

            /**
             * 开始一个新游戏
             * @param {number} levelIndex 关卡索引
             */
            function startGame(levelIndex) {
                currentLevelIndex = levelIndex; // 修改：保存当前关卡索引
                currentLevel = LEVELS[currentLevelIndex]; // 修改：移除 const，赋值给外部变量
                currentStep = 0;
                startTime = 0; // 计时器在第一次按键时启动
                gameActive = true;
                
                // 重置玩家状态
                playerState = [0, 0, 0, 0, 0]; // 修改：5个元素
                updatePlayerDisplay();
                
                dom.levelTitle.textContent = currentLevel.name;
                dom.timer.textContent = "0.00s";
                
                loadStep(0);
                showScreen('game');
            }

            /**
             * 加载关卡的特定步骤
             * @param {number} stepIndex 步骤索引
             */
            function loadStep(stepIndex) {
                currentStep = stepIndex;
                const targetPattern = currentLevel.patterns[currentStep];
                
                // 更新目标圆点显示
                targetPattern.forEach((value, index) => {
                    dom.targetDots[index].classList.toggle('pressed', value === 1);
                });
                
                // 更新步骤计数器
                dom.stepCounter.textContent = `Step ${currentStep + 1} / ${currentLevel.patterns.length}`;
                
                // 检查是否在"全松开"的状态下就已通关
                checkWinCondition();
            }

            /**
             * 更新玩家的圆点显示
             */
            function updatePlayerDisplay() {
                playerState.forEach((value, index) => {
                    dom.playerDots[index].classList.toggle('player-pressed', value === 1);
                });
            }

            /**
             * 检查玩家状态是否匹配目标图案
             */
            function checkWinCondition() {
                if (!gameActive) return;

                const targetPattern = currentLevel.patterns[currentStep];
                
                // 比较玩家状态和目标状态
                const match = playerState.every((value, index) => value === targetPattern[index]);

                if (match) {
                    // 匹配成功！进入下一步或结束游戏
                    if (currentStep < currentLevel.patterns.length - 1) {
                        // 进入下一步
                        loadStep(currentStep + 1);
                    } else {
                        // 关卡完成
                        endGame();
                    }
                }
            }

            /**
             * 结束游戏并显示结果
             */
            function endGame() {
                gameActive = false;
                stopTimer();
                if (audioEnabled) {
                    polySynth.releaseAll(); // 3. 游戏结束时停止所有声音
                }
                const finalTimeInSeconds = (Date.now() - startTime) / 1000;
                
                dom.finalTime.textContent = `Your Time: ${finalTimeInSeconds.toFixed(2)}s`;
                
                // 计算排名
                const ranks = currentLevel.ranks;
                let rank = 'C'; // 默认
                if (finalTimeInSeconds <= ranks[0]) rank = 'S';
                else if (finalTimeInSeconds <= ranks[1]) rank = 'A';
                else if (finalTimeInSeconds <= ranks[2]) rank = 'B';
                
                dom.rank.textContent = rank;
                dom.rank.className = `rank-${rank}`; // 用于设置不同颜色
                
                // 新增：检查是否有下一关，并显示/隐藏按钮
                const hasNextLevel = (currentLevelIndex + 1) < LEVELS.length;
                dom.nextLevelBtn.style.display = hasNextLevel ? 'inline-block' : 'none';

                showScreen('result');
            }

            // --- 5. 计时器函数 ---
            function startTimer() {
                startTime = Date.now();
                dom.timer.textContent = "0.00s";
                timerInterval = setInterval(() => {
                    const elapsed = (Date.now() - startTime) / 1000;
                    dom.timer.textContent = `${elapsed.toFixed(2)}s`;
                }, 10); // 每 10 毫秒更新一次，显示两位小数
            }

            function stopTimer() {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            // --- 6. 键盘事件监听 ---
            
            function handleKeyDown(e) {
                // 修改：新增 ' ' (空格) 来阻止默认行为
                if (e.key === 'j' || e.key === 'l' || e.key === ';' || e.key === ' ') {
                    e.preventDefault();
                }

                // --- 修改：重构逻辑以处理“任意键继续” ---

                // 1. 检查游戏是否激活
                if (gameActive) {
                    const keyIndex = KEY_MAP[e.key];
                    if (keyIndex === undefined) return; // 按下了无关按键

                    // 4. 播放声音
                    if (audioEnabled) {
                        const note = KEY_NOTES[e.key];
                        if (note && playerState[keyIndex] === 0) { // 仅在按键第一次按下时触发
                            polySynth.triggerAttack(note, Tone.now());
                        }
                    }

                    // 第一次按键时启动计时器
                    if (startTime === 0) {
                        startTimer();
                    }
                    
                    // 如果状态未改变，则不重复触发
                    if (playerState[keyIndex] === 1) return; 

                    playerState[keyIndex] = 1;
                    updatePlayerDisplay();
                    checkWinCondition();
                    return; // 处理完游戏逻辑后退出
                }

                // 2. 检查结果屏幕是否激活（用于“任意键继续”）
                if (screens.result.classList.contains('active')) {
                    const hasNextLevel = (currentLevelIndex + 1) < LEVELS.length;
                    if (hasNextLevel) {
                        e.preventDefault(); // 阻止空格等按键的默认行为
                        startGame(currentLevelIndex + 1);
                    }
                }
                // --- 修改结束 ---
            }

            function handleKeyUp(e) {
                if (!gameActive) return;

                const keyIndex = KEY_MAP[e.key];
                if (keyIndex === undefined) return;

                // 5. 停止声音
                if (audioEnabled) {
                    const note = KEY_NOTES[e.key];
                    if (note) {
                        polySynth.triggerRelease(note, Tone.now());
                    }
                }

                // 如果状态未改变，则不重复触发
                if (playerState[keyIndex] === 0) return; 

                playerState[keyIndex] = 0;
                updatePlayerDisplay();
                checkWinCondition();
            }

            // --- 7. 初始化 ---
            function init() {
                // 绑定全局事件监听
                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);

                // 绑定返回菜单按钮
                dom.backToMenuBtn.onclick = () => {
                    gameActive = false;
                    if (timerInterval) stopTimer();
                    if (audioEnabled) {
                        polySynth.releaseAll(); // 6. 返回菜单时停止所有声音
                    }
                    setupLevelSelect();
                    showScreen('levelSelect');
                };

                // 新增：绑定“下一关”按钮
                dom.nextLevelBtn.onclick = () => { // 修正：移除了多余的 'D'
                    const hasNextLevel = (currentLevelIndex + 1) < LEVELS.length;
                    if (hasNextLevel) {
                        startGame(currentLevelIndex + 1);
                    }
                };

                // 启动！
                setupLevelSelect();
                showScreen('levelSelect');
            }

            // 运行初始化
            init();
        } // end of initGame
    </script>
</body>
</html>